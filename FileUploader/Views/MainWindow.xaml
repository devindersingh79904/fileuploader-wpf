<Window x:Class="FileUploader.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:FileUploader.Views"
        mc:Ignorable="d"
        Title="MainWindow" Height="450" Width="800"
        Loaded="Window_Loaded">
    <DockPanel Margin="16">
        <StackPanel Orientation="Horizontal" DockPanel.Dock="Top" Margin="0,0,0,8">
            <Button Content="Select Files" Width="120" Command="{Binding SelectFilesCommand}" />
            <Button Content="Start Upload" Width="120" Margin="8,0,0,0" Command="{Binding StartUploadCommand}" />
            <Button Content="Pause" Width="80" Margin="8,0,0,0" Command="{Binding PauseAllCommand}" />
            <Button Content="Resume" Width="80" Margin="8,0,0,0" Command="{Binding ResumeAllCommand}"/>
            <Button Content="Cancel All" Width="120" Margin="16,0,0,0" Command="{Binding CancelAllCommand}" />
        </StackPanel>

        <TextBlock Text="{Binding SessionStatus}"
           Margin="0,4,0,8"
           FontStyle="Italic"
           Foreground="DarkBlue"
           DockPanel.Dock="Top"/>
        
        <TextBlock Text="{Binding SessionId, StringFormat=Session: {0}}"
                   Margin="0,0,0,8"
                   Foreground="DarkGreen"
                   DockPanel.Dock="Top"/>
        
        <ListView ItemsSource="{Binding Files}" 
          DockPanel.Dock="Top" 
          Margin="0,0,0,8"
          VerticalAlignment="Stretch"
          ScrollViewer.VerticalScrollBarVisibility="Auto"
          MaxHeight="250">
            <ListView.View>
                <GridView>
                    <GridViewColumn Header="#" Width="40" DisplayMemberBinding="{Binding Index}" />
                    <GridViewColumn Header="File" Width="200" DisplayMemberBinding="{Binding FileName}" />
                    <GridViewColumn Header="Size" Width="100" DisplayMemberBinding="{Binding SizeHuman}" />
                    <GridViewColumn Header="Path" Width="220" DisplayMemberBinding="{Binding FilePath}" />

                    <!-- Progress Column -->
                    <GridViewColumn Header="Progress" Width="150">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <ProgressBar Minimum="0" Maximum="100"
                                             Value="{Binding Progress}" Height="18"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <!-- Status Column -->
                    <GridViewColumn Header="Status" Width="100" DisplayMemberBinding="{Binding Status}" />

                    <GridViewColumn Header="Error" Width="180" DisplayMemberBinding="{Binding ErrorMessage}" />
                    <!-- Action Column -->
                    <GridViewColumn Header="Action" Width="120">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="Delete" Width="80"
        Command="{Binding DataContext.DeleteFileCommand,
                          RelativeSource={RelativeSource AncestorType=ListView}}"
        CommandParameter="{Binding}"/>

                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                </GridView>
            </ListView.View>
        </ListView>

        <!-- ✅ Overall progress docked to bottom, INSIDE the DockPanel -->
        <StackPanel DockPanel.Dock="Bottom" Margin="0,8,0,0">
            <TextBlock Text="{Binding OverallProgressText}"
               Margin="0,0,0,4" FontWeight="Bold"/>
            <ProgressBar Minimum="0" Maximum="100"
                 Value="{Binding OverallProgress}"
                 Height="20"/>
        </StackPanel>

    </DockPanel>
</Window>
